FLIP DECK DUNGEON
TECHNICAL DESIGN DOCUMENT (TDD)

========================
1. ARQUITECTURA GENERAL
========================
Motor: Godot 4.5
Separacion estricta entre:
- Logica
- Datos
- UI

========================
2. RUNMANAGER (SOURCE OF TRUTH)
========================
Archivo: data/run_manager.gd (autoload RunState)
Responsable de:
- Estado de la run (modo, oleada, mazos activos)
- Cartas runtime y colas de robo por mazo
- Economia (oro de run, danger level)
- XP y level up
- Items (mano, equipamiento, sets)
- Traits activos
- Aplicar upgrades de heroe a stats runtime (HP, damage, armour, initiative, regen, block, evasion, lifesteal%, healing power)
- Modificadores de economia (bono de oro, chance de drop y rareza)
- Guardado/carga de run (user://save/save_run.json)
- Guardado/carga de run_deck (user://save/run_deck.json)

========================
3. COMBATMANAGER
========================
Archivo: scripts/combat/combat_context.gd
- Orquestador logico del combate
- No conoce UI ni animaciones
- Resuelve iniciativa y orden de turnos
- Aplica damage, armour, lifesteal (flat + %), evasion, block (con escudo), regen y healing power
- Comunica por senales (attack_started, damage_applied, card_died, combat_finished)

========================
4. BATTLETABLE (UI ORQUESTA)
========================
Archivo: scripts/game/battle_table.gd
- Instancia CardView y posiciona cartas
- Maneja mazos visuales, slots y robo
- Conecta CombatManager con UI
- Maneja Crossroads, level up, pause, victory y defeat
- Controla auto-draw y auto-combat

========================
5. CARDVIEW
========================
Archivo: scripts/game/card_view.gd
- UI pura, refleja estado sin modificar logica
- Base size 620x860, escalado en BattleTable y Collection

========================
6. RESOURCES Y DATA
========================
- CardDefinition (heroes y enemigos)
- ItemCardDefinition (items de run)
- TraitResource + TraitDatabase
- BoosterPackDefinition
- PlayerCollection + Serialization
- ItemCatalog (res://data/item_catalog_default.tres)

========================
7. PERSISTENCIA
========================
Archivo: data/save_system.gd
- Coleccion persistente: user://save/card_collection.json
- Perfil: user://save/save_profile.json
- Run: user://save/save_run.json
- Run deck: user://save/run_deck.json

========================
8. LOCALIZACION
========================
- assets/localization/game_text.csv
- LocalizationManager como gateway de strings

========================
9. AUDIO
========================
- MusicManager global con playlists y crossfade
- audio_bus_layout.tres con buses Master/Music/SFX
- Settings mutea buses Music/SFX cuando slider = 0
