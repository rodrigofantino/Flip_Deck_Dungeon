FLIP DECK DUNGEON
IMPLEMENTED DESIGN DOCUMENT (IDD)

Este documento lista lo que YA esta implementado en el proyecto.

========================
1. CORE LOOP Y COMBATE
========================
- Run con heroe y enemigos en combate por turnos
- Robo real desde 1 a 5 mazos activos y combate por enemigo en mesa
- CombatManager orquesta turnos con iniciativa por enemigo
- Formula de iniciativa: clamp(0.15, 0.85, 0.5 + (hero_init - enemy_init) * 0.05)
- Orden de ataque respeta iniciativa; si el primero mata, el segundo no ataca
- Mitigacion por armour, lifesteal (flat + %), evasion y block (solo con escudo) aplicados en combate
- Regen aplicada por ronda de combate y healing power amplifica curaciones
- Recompensas por enemigo: oro + XP segun nivel
- Level up: cura al maximo, escala stats (heroe +20%, enemigos +25%), actualiza niveles visibles
- Traits activos se limpian al subir de nivel
- Danger level = suma de poder enemigo (HP + dano, con nivel), mostrado en HUD
- Auto-draw y auto-combat (toggles en Battle HUD)

========================
2. WAVES Y CROSSROADS
========================
- Run en oleadas (cantidad variable por quest, Forest = 20)
- Al limpiar todos los enemigos de los mazos activos se abre Crossroads
- Opciones Crossroads: agregar mazo (max 5), retirar 25% del oro de run, elegir traits
- Cada 5 oleadas hay un miniboss (cicla por lista de minibosses)
- Tras la ultima oleada y sin enemigos activos aparece el boss final
- Tras el boss final se dispara victoria (con recompensa final de oro)

========================
3. TRAITS (V1)
========================
- TraitResource para heroe y enemigo (flat y multiplicadores de HP/Dano/Iniciativa/Nivel)
- Base de datos de traits con pools separados (hero/enemy)
- Seleccion de traits desde popup en Crossroads
- Traits se aplican a enemigos existentes y a los que esten en cola

========================
4. ITEMS Y EQUIPAMIENTO (V1)
========================
- ItemCardDefinition con stats flat y set_theme
- Drop de items al morir enemigo (50%)
- Mano de items (max 6) con FIFO y layout en abanico
- Drag & drop a equipamiento (7 slots)
- Reemplazo por tipo y stats en heroe (armour, damage, life, initiative, lifesteal, thorns, regen, crit)
- One-hand separa sword y shield para permitir ambos
- Completar set tematico consume items, aplica bonus permanentes y permite seguir equipando
- Sets repetibles con bonos acumulativos
- Boton debug en BattleTable para dropear un set completo

========================
5. SELECCION DE RUN Y DECKS
========================
- Boton Play abre coleccion en modo seleccion (selection_pending)
- El jugador elige 1 heroe y 1+ enemigos; Start Dungeon se habilita al cumplir
- En Guild hay selector de quest (popup) con arte y dificultad (1..6)
- La quest seleccionada se guarda en GameState (selected_quest_id y selected_quest_level)
- RunManager construye cartas runtime desde run_deck
- run_deck se guarda en user://save/run_deck.json (por mazos)
- save_run.json guarda estado de run (cartas, ordenes, mano/equip, traits, oro, etc.)
- Continue habilitado si hay save de run

========================
6. COLECCION, BOOSTERS Y SHOP
========================
- BookView con PageFlip (prototipo 3D) y grilla de cartas
- Apertura de sobres desde la coleccion (5 cartas por pack)
- Shop con packs Forest y Dark Forest
- Comprar descuenta oro persistente y agrega booster al save
- Popup de carta con upgrade: gastar 5 copias para +1 nivel
- Upgrades se reflejan en combate (heroe +20%, enemigo +25% por nivel de upgrade)

========================
7. UI, VFX Y AUDIO
========================
- Main menu con oro persistente
- Pause popup, defeat popup, victory popup, level up popup
- Battle HUD con oro, danger y chance de atacar primero
- VFX de victoria (rays, confetti, motes, mini cards, coins, shine)
- MusicManager con playlists de menu y batalla + crossfade
- Settings con sliders de volumen Master, Music y SFX (mute real en 0)
- Settings con opciones de video (modo pantalla, resolucion, VSync, limite FPS)
- Popups de coleccion bloquean input en elementos de fondo (hero upgrades y upgrades de carta)

========================
8. LOCALIZACION Y ASSETS
========================
- Strings UI en CSV (menu, shop, victory, defeat, level up, crossroads)
- Arte tutorial y dark forest
- Frames de cartas actualizados
- Arte de items y fondo de carta de item
