FLIP DECK DUNGEON
IMPLEMENTED DESIGN DOCUMENT (IDD)

Este documento lista lo que YA esta implementado en el proyecto.

========================
1. CORE LOOP IMPLEMENTADO
========================
- Run con heroe y enemigos en combate por turnos
- Robo de enemigo, combate, resolucion y limpieza de estado
- Recompensas al derrotar enemigos (oro y XP por nivel del enemigo)
- Al subir de nivel, el heroe se cura al maximo y su carta refleja el nivel de la run (no persistente)
- Al subir de nivel, TODOS los enemigos de la run suben tambien su nivel visible
- Al subir de nivel, hero escala stats base (+20%) y enemigos (+25%); futuras spawns heredan ese nivel

========================
2. NUEVA RUN Y SELECCION DE CARTAS
========================
- Boton Play abre la coleccion en modo seleccion (selection_pending)
- El jugador elige 1 heroe y 1+ enemigos; Start Dungeon se habilita al cumplir
- Se genera un run_deck (run_deck.json) con run_id, definition_id y collection_id
- Las cartas no persistentes elegidas se remueven de la coleccion al iniciar la run
- RunManager construye las cartas runtime desde el run_deck al iniciar combate
- Al derrotar cartas, se remueven del run_deck para mantener el progreso de la run
- En el flujo de seleccion se puede volver al menu desde Coleccion (Back visible)
- Sobres permanecen habilitados en la coleccion aun entrando desde Jugar
- Area de sobres no bloquea clicks del libro ni botones

========================
3. VICTORIA / DERROTA
========================
- Popup de derrota con boton volver al menu
- Popup de victoria con celebracion y VFX (code-driven)
- La victoria muestra oro ganado
- La victoria no muestra level up si no hay enemigos restantes
- Al ganar se guarda oro en progreso persistente (no en derrota/pausa)
- Al volver al menu desde victoria/derrota se limpia el save de run (Continue deshabilitado)

========================
4. VICTORY VFX (CODE-DRIVEN)
========================
- Dimmer overlay con breathing
- Rays/halo con rotacion suave
- Confetti full screen y lluvia continua
- Motes/bolitas full screen
- Mini cards y hojas en bursts
- Monedas doradas salen del texto de oro durante el conteo
- Shine sweep en titulo y reflejo metalico animado en oro
- SFX de flip de carta y monedas (drop y count)

========================
5. ECONOMIA Y PERSISTENCIA
========================
- Oro persistente en coleccion
- Save de run separado (save_run.json)
- Continue habilitado si hay save
- Boton dev reset para limpiar progreso persistente

========================
6. SHOP
========================
- Shop con un pack Dark Forest
- Boton Buy se habilita si alcanza el oro
- Al comprar, se descuenta oro y se agrega booster en el save

========================
7. BOOSTERS
========================
- BoosterPackDefinition resource
- booster_pack_dark_forest.tres
- boosters guardados en PlayerCollection

========================
8. UI IMPLEMENTADA
========================
- Main menu con oro persistente
- Pause popup
- Level up popup
- Battle HUD
- Collection UI base
- Battle HUD muestra chance de atacar primero
- Mano de items (loot) con layout en abanico, hover y drag & drop
- Zona de equipamiento bajo el heroe con slots por tipo

========================
9. LOCALIZACION
========================
- Strings de UI en CSV
- Shop, menu, victory, defeat, level up
- Etiqueta de iniciativa en CardView (Init)

========================
10. ASSETS Y CONTENIDO
========================
- Arte tutorial y dark forest
- Definiciones de cartas dark forest
- Frames de cartas actualizados
- Arte de items (cascos) y fondo de carta de item

========================
11. SISTEMA DE INICIATIVA
========================
- Iniciativa por carta (0..10) con probabilidad de atacar primero
- Formula: clamp(0.15, 0.85, 0.5 + (hero_init - enemy_init) * 0.05)
- Sorteo por combate usando RNG del proyecto
- Orden de ataque respeta la iniciativa; si el primero mata, el segundo no ataca

========================
14. LOOT ITEMS Y EQUIPAMIENTO (V1)
========================
- ItemCardDefinition resource con stats flat y tipos de item
- Drop de items al morir enemigo
- Mano de items (max 5) con FIFO y visual en abanico
- Drag & drop a equipamiento por slots de tipo (helmet, armour, gloves, boots, one_hand, two_hands, amulet, ring)
- Reemplazo por tipo y aplicacion de stats en hero (armour, damage, life, initiative, lifesteal, thorns, regen, crit)
- Upgrades de cartas en coleccion (+1 nivel y stats por multiplicador del tipo): heroes +20%, enemigos +25%, se reflejan en combate
- Armour reduce da√±o recibido (shield se trata como armour)

========================
12. LIBRO DE COLECCION 3D (PROTOTIPO)
========================
- Flag en Collection para alternar entre libro 2D y prototipo 3D
- BookView basado en PageFlip con tapa, contraportada y contenido de paginas con grilla de cartas
- Flip por click en bordes con banda de deteccion ampliada
- Click en cartas funciona con seleccion (heroe/enemigos) y feedback visual de borde
- Fondo de coleccion nuevo (colection_background.png) en modo cover, centrado
- BookView ajusta posicion/escala al abrir/cerrar sin warpeos

========================
13. AUDIO (MUSICA + SETTINGS)
========================
- MusicManager global con playlists de musica de menu y batalla
- Crossfade entre musica de menu y batalla, sin cortes al navegar UI
- Carpetas separadas para music/background y music/battle
- Settings con sliders de volumen Master, Music y SFX (bus audio)
